# Memory Guardian

**å››å±¤é˜²è­·ä¸Šä¸‹æ–‡è¨˜æ†¶ç³»çµ±** for OpenClaw

é€™æ˜¯ä¸€å€‹ OpenClaw æ’ä»¶ï¼Œæä¾›å®Œæ•´çš„æœ¬åœ°å‘é‡æª¢ç´¢å’Œä¸Šä¸‹æ–‡ä¿è­·åŠŸèƒ½ï¼Œç¢ºä¿ Agent åœ¨é•·å°è©±ä¸­ä¸æœƒéºå¤±é—œéµä¿¡æ¯ã€‚

## ğŸ¯ åŠŸèƒ½æ¦‚è¦½

| çµ„ä»¶ | åŠŸèƒ½ | è§¸ç™¼æ–¹å¼ |
|------|------|----------|
| **Heartbeat Summarizer** | å®šæ™‚ç”Ÿæˆå°è©±æ—¥å ± | æ¯å°æ™‚è‡ªå‹• / RPC æ‰‹å‹• |
| **Anti-Amnesia Injector** | ä¸Šä¸‹æ–‡å£“ç¸®ä¿è­· | `command:new` / `command:reset` |
| **FAISS Vectorizer** | æœ¬åœ°å‘é‡ç´¢å¼• | æœå‹™å•Ÿå‹•æ™‚ + ç•°æ­¥éšŠåˆ— |
| **RAG Injector** | æ­·å²è¨˜æ†¶æ³¨å…¥ | `agent:bootstrap` |

## ğŸ“¦ å®‰è£

### å‰ç½®éœ€æ±‚

- Node.js >= 18
- OpenClaw >= 2026.1.0
- æœ¬åœ° LLM æœå‹™ï¼ˆæ¨è–¦ Ollamaï¼‰

### å®‰è£ä¾è³´

```bash
cd ~/.openclaw/extensions/memory-guardian
npm install
```

### å•Ÿç”¨æ’ä»¶

åœ¨ `~/.openclaw/openclaw.json` ä¸­æ·»åŠ ï¼š

```json
{
  "plugins": {
    "enabled": true,
    "entries": {
      "memory-guardian": {
        "enabled": true,
        "config": {
          "summarizeIntervalMs": 3600000,
          "ragTopK": 5,
          "localLlmEndpoint": "http://localhost:11434/api/generate",
          "localLlmModel": "qwen2.5:7b"
        }
      }
    }
  }
}
```

é‡å•Ÿ Gatewayï¼š

```bash
openclaw gateway restart
```

## ğŸ”§ é…ç½®é¸é …

| é¸é … | é¡å‹ | é»˜èªå€¼ | èªªæ˜ |
|------|------|--------|------|
| `summarizeIntervalMs` | number | 3600000 | å¿ƒè·³æ‘˜è¦é–“éš”ï¼ˆæ¯«ç§’ï¼‰ |
| `ragTopK` | number | 5 | RAG æª¢ç´¢è¿”å›çš„çµæœæ•¸é‡ |
| `chunkSize` | number | 512 | æ–‡æœ¬åˆ‡å¡Šå¤§å°ï¼ˆå­—ç¬¦ï¼‰ |
| `chunkOverlap` | number | 64 | åˆ‡å¡Šé‡ç–Šé•·åº¦ |
| `recentMessagesCount` | number | 30 | åéºå¿˜æ³¨å…¥æ™‚æå–çš„æ¶ˆæ¯æ•¸ |
| `embeddingModel` | string | "Xenova/all-MiniLM-L6-v2" | Embedding æ¨¡å‹åç¨± |
| `localLlmEndpoint` | string | "http://localhost:11434/api/generate" | Ollama API ç«¯é» |
| `localLlmModel` | string | "qwen2.5:7b" | æœ¬åœ° LLM æ¨¡å‹åç¨± |

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æŸ¥çœ‹ç‹€æ…‹

```bash
openclaw rpc memory-guardian.status
```

### æ‰‹å‹•è§¸ç™¼æ‘˜è¦

```bash
openclaw rpc memory-guardian.summarize
```

### ç²å–æœ€æ–°æ—¥å ±

```bash
openclaw rpc memory-guardian.report
```

### æœç´¢æ­·å²è¨˜æ†¶

```bash
openclaw rpc memory-guardian.search --query "API è¨­è¨ˆæ±ºç­–"
```

### ç´¢å¼•æ–‡æœ¬

```bash
openclaw rpc memory-guardian.index --text "é‡è¦ä¿¡æ¯..." --sourcePath "manual"
```

### é‡å»ºç´¢å¼•

```bash
openclaw rpc memory-guardian.reindex
```

## ğŸ“ æ•¸æ“šå­˜å„²

æ‰€æœ‰æ•¸æ“šå­˜å„²åœ¨ workspace ç›®éŒ„ä¸‹ï¼š

```
~/.openclaw/workspace/
â”œâ”€â”€ reports/
â”‚   â””â”€â”€ daily_report_latest.md    # æœ€æ–°æ—¥å ±
â”œâ”€â”€ memory/
â”‚   â””â”€â”€ *.md                       # æœƒè©±æ—¥èªŒ
â””â”€â”€ .memory-guardian/
    â”œâ”€â”€ vector.index               # FAISS ç´¢å¼•
    â”œâ”€â”€ vector.meta.json           # å‘é‡å…ƒæ•¸æ“š
    â””â”€â”€ critical_context.json      # ç·©å­˜çš„é—œéµä¸Šä¸‹æ–‡
```

## ğŸ”Œ Hooks

### session-protect

- **äº‹ä»¶**: `command:new`, `command:reset`
- **åŠŸèƒ½**: åœ¨ session é‡ç½®å‰ä¿å­˜é—œéµä¸Šä¸‹æ–‡

### bootstrap-inject

- **äº‹ä»¶**: `agent:bootstrap`
- **åŠŸèƒ½**: å°‡ä¿è­·çš„ä¸Šä¸‹æ–‡å’Œ RAG çµæœæ³¨å…¥åˆ° System Prompt

## ğŸ—ï¸ æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Memory Guardian                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Heartbeat        â”‚  â”‚ FAISS            â”‚                  â”‚
â”‚  â”‚ Summarizer       â”‚  â”‚ Vectorizer       â”‚                  â”‚
â”‚  â”‚ (Service)        â”‚  â”‚ (Service)        â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚           â”‚                     â”‚                             â”‚
â”‚           â–¼                     â–¼                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚             ~/.openclaw/workspace/        â”‚                â”‚
â”‚  â”‚  reports/daily_report_latest.md           â”‚                â”‚
â”‚  â”‚  .memory-guardian/vector.index            â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚           â”‚                     â”‚                             â”‚
â”‚           â–¼                     â–¼                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Anti-Amnesia     â”‚  â”‚ RAG              â”‚                  â”‚
â”‚  â”‚ Injector         â”‚  â”‚ Injector         â”‚                  â”‚
â”‚  â”‚ (Hook)           â”‚  â”‚ (Hook)           â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚           â”‚                     â”‚                             â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                     â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚          agent:bootstrap                  â”‚                â”‚
â”‚  â”‚  <critical_context>...</critical_context> â”‚                â”‚
â”‚  â”‚  <historical_memory>...</historical_memory>â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âš¡ æ€§èƒ½

- **Embedding æ¨¡å‹**: all-MiniLM-L6-v2ï¼ˆé‡åŒ–ç‰ˆï¼Œ~22MBï¼‰
- **å‘é‡ç¶­åº¦**: 384
- **RAG æª¢ç´¢ç›®æ¨™**: < 300ms
- **é¦–æ¬¡åŠ è¼‰**: ~2-5 ç§’ï¼ˆæ¨¡å‹ä¸‹è¼‰/åŠ è¼‰ï¼‰

## ğŸ› ï¸ é–‹ç™¼

```bash
# å®‰è£é–‹ç™¼ä¾è³´
npm install

# é¡å‹æª¢æŸ¥
npm run build

# é‹è¡Œæ¸¬è©¦
npm test
```

## ğŸ“ License

MIT

## ğŸ™ Credits

- [Xenova/transformers.js](https://github.com/xenova/transformers.js) - æœ¬åœ° Embedding
- [faiss-node](https://github.com/ewfian/faiss-node) - FAISS Node.js ç¶å®š
- [OpenClaw](https://github.com/openclaw/openclaw) - AI Agent æ¡†æ¶
